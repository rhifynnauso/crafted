<div class="search-bar">
  <input [formControl]="searchFormControl" placeholder="Search" class="search">
  <button mat-icon-button [mat-menu-trigger-for]="filterTypesMenu" type="button"
          *ngIf="filterer.metadata.size > 0" matTooltip="Add filter"
          class="new-filter">
    <mat-icon> filter_list </mat-icon>
  </button>
</div>

<div class="filter-container" [@expand]="expandState"
     *ngFor="let filter of (filterer.state | async)?.filters; let index = index; trackBy: trackByIndex">
  <div class="filter-label">
    {{filterer.metadata.get(filter.id).label}}:
  </div>

  <ng-container [ngSwitch]="filter.type">
    <input-query-form *ngSwitchCase="'input'" [input]="filter.input"
                      [equality]="filter.equality"
                      [options]="autocomplete.get(filter.type) | async"
                      [focusInput]="focusInput"
                      (changed)="inputFilterChanged(index, $event.input, $event.equality)">
    </input-query-form>

    <number-query-form *ngSwitchCase="'number'" [value]="filter.value"
                       [equality]="filter.equality" [focusInput]="focusInput"
                       (changed)="numberFilterChanged(index, $event.value, $event.equality)">
    </number-query-form>

    <date-query-form *ngSwitchCase="'date'" [date]="filter.date"
                     [equality]="filter.equality"
                     (changed)="dateFilterChanged(index, $event.date, $event.equality)">
    </date-query-form>

    <state-query-form *ngSwitchCase="'state'" [state]="filter.state"
                      [equality]="filter.equality"
                      [states]="states.get(filter.type)"
                      (changed)="stateFilterChanged(index, $event.state, $event.equality)">
    </state-query-form>

    <button mat-icon-button class="remove-filter" type="button"
            (click)="removeFilter(filter)">
      <mat-icon> close </mat-icon>
    </button>
  </ng-container>
</div>

<!-- Filter Types Menu -->
<mat-menu #filterTypesMenu="matMenu" xPosition="before"
          class="advanced-search-filter-menu">
  <div class="menu-title">Filter by:</div>
  <mat-divider></mat-divider>
  <button mat-menu-item *ngFor="let filterOption of displayedFilterOptions"
          (click)="addFilter(filterOption.id)">
    {{filterOption.label}}
  </button>
</mat-menu>
