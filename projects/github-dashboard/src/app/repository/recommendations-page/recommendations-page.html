<div class="recommendations" *ngIf="sortedRecommendations | async; let list">

  <div *ngIf="!list.length" class="empty-state theme-secondary-text">
    <mat-icon class="page-icon"> label </mat-icon>
    <div>
      Configure actionable warnings and suggestions for your data.
    </div>

    <div class="create-new">
      <ng-container *ngTemplateOutlet="newButton"></ng-container>
    </div>
  </div>


  <div class="heading" *ngIf="(recommendations | async)?.length > 3">
    <input [formControl]="filter" class="theme-border"
           placeholder="Filter recommendations">
  </div>

  <div *ngFor="let recommendation of list; trackBy: trackById"
       class="recommendation">
    <div class="title"
         *ngIf="recommendationTypes[recommendation.type]; let typeMeta">
      <mat-icon [class.theme-warn]="typeMeta.warn" class="type">
        {{typeMeta.icon}}
      </mat-icon>

      <div class="message">
        {{recommendation.message}}
      </div>

      <button mat-icon-button [matMenuTriggerFor]="recommendationMenu">
        <mat-icon> more_vert </mat-icon>
      </button>
    </div>

    <div class="details theme-secondary-text">
      <div class="filterer">
        {{filtererStateToString(recommendation.filtererState, recommendation.data)}}
      </div>

      <div *ngIf="recommendation.actionType !== 'none'">
        {{actionTypes[recommendation.actionType].label}}:

        <ng-container [ngSwitch]="recommendation.actionType">
          <ng-container *ngSwitchCase="'add-label'">
            {{recommendation.action.labels.join(', ')}}
          </ng-container>

          <ng-container *ngSwitchCase="'add-assignee'">
            {{recommendation.action.assignees.join(', ')}}
          </ng-container>
        </ng-container>
      </div>
    </div>
    <mat-divider></mat-divider>

    <mat-menu #recommendationMenu="matMenu" xPosition="before">
      <button mat-menu-item (click)="edit(recommendation)">
        <mat-icon> edit </mat-icon>
        Edit
      </button>
      <button mat-menu-item (click)="duplicate(recommendation)">
        <mat-icon> file_copy </mat-icon>
        Duplicate
      </button>
      <button mat-menu-item (click)="remove(recommendation)">
        <mat-icon> delete </mat-icon>
        Remove
      </button>
    </mat-menu>
  </div>
</div>

<ng-template cdkPortal #newButton>
  <button mat-raised-button color="accent" class="create" (click)="add()">
    Create New Recommendation
  </button>
</ng-template>
